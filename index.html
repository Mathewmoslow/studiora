<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/studiora-icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e40af">
    <title>Studiora - Intelligent Nursing Schedule Planner</title>
    <meta name="description" content="AI-powered nursing education schedule planner with intelligent syllabus parsing" />
    
    <!-- Add this modern meta tag -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Apple-specific -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="/studiora-icon-180.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="Studiora - Intelligent Nursing Schedule Planner">
    <meta property="og:description" content="AI-powered nursing education schedule planner with intelligent syllabus parsing">
    <meta property="og:image" content="/studiora-preview.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    // Complete Dashboard Integration Script
// Add this to your main dashboard HTML to integrate all calendar management features

// Global initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing enhanced dashboard...');
    
    // 1. Initialize the adaptive scheduler
    if (!window.adaptiveScheduler) {
        window.adaptiveScheduler = new AdaptiveScheduler();
    }
    
    // 2. Load and initialize custom events
    window.customEvents = JSON.parse(localStorage.getItem('customEvents') || '[]');
    
    // 3. Enhanced calendar initialization
    if (window.calendar) {
        initializeEnhancedCalendar();
    }
    
    // 4. Update UI components
    updateSchedulerStats();
    
    // 5. Add calendar manager button to header
    addCalendarManagerButton();
    
    // 6. Initialize event listeners
    initializeEventListeners();
});

// Enhanced calendar setup
function initializeEnhancedCalendar() {
    // Make calendar interactive
    calendar.setOption('editable', true);
    calendar.setOption('eventStartEditable', true);
    calendar.setOption('eventDurationEditable', true);
    calendar.setOption('eventResizableFromStart', true);
    
    // Add custom events to calendar
    window.customEvents.forEach(event => {
        calendar.addEvent(event);
    });
    
    // Event change handler (drag & drop, resize)
    calendar.on('eventChange', function(info) {
        handleEventChange(info.event, info.oldEvent);
    });
    
    // Event click handler
    calendar.on('eventClick', function(info) {
        // Prevent default browser navigation
        info.jsEvent.preventDefault();
        
        const event = info.event;
        
        // Show different options based on event type
        if (event.id && event.id.startsWith('adaptive_')) {
            // Adaptive event - show info
            showAdaptiveEventInfo(event);
        } else if (event.extendedProps.isCustom || event.id.startsWith('custom_')) {
            // Custom event - open editor
            editEvent(event.id);
        } else {
            // Original event - show details
            showEventDetails(event);
        }
    });
    
    // Add event on date click
    calendar.on('dateClick', function(info) {
        // Quick add event
        quickAddEvent(info.date);
    });
    
    // Context menu for right-click
    calendar.on('eventMouseEnter', function(info) {
        // Add tooltip
        info.el.setAttribute('title', getEventTooltip(info.event));
    });
}

// Handle event changes
function handleEventChange(event, oldEvent) {
    const eventData = {
        id: event.id,
        title: event.title,
        start: event.start.toISOString(),
        end: event.end ? event.end.toISOString() : event.start.toISOString(),
        color: event.backgroundColor,
        extendedProps: event.extendedProps
    };
    
    // Update in arrays
    [window.calendarEvents, window.customEvents].forEach(events => {
        const index = events.findIndex(e => e.id === event.id);
        if (index !== -1) {
            events[index] = eventData;
        }
    });
    
    // Save custom events
    if (event.id.startsWith('custom_') || event.extendedProps.isCustom) {
        localStorage.setItem('customEvents', JSON.stringify(window.customEvents));
    }
    
    // Show confirmation
    showNotification('Event updated', 'success');
}

// Quick add event function
function quickAddEvent(date) {
    const title = prompt('Event title:');
    if (!title) return;
    
    const event = {
        id: `custom_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        title: title,
        start: date.toISOString().split('T')[0] + 'T09:00:00',
        end: date.toISOString().split('T')[0] + 'T10:00:00',
        color: '#2196F3',
        extendedProps: {
            type: 'personal',
            isCustom: true,
            notes: ''
        }
    };
    
    calendar.addEvent(event);
    window.customEvents.push(event);
    localStorage.setItem('customEvents', JSON.stringify(window.customEvents));
    
    // Open editor for full details
    setTimeout(() => editEvent(event.id), 100);
}

// Show adaptive event info
function showAdaptiveEventInfo(event) {
    const info = `
        <strong>${event.title}</strong><br>
        Time: ${formatEventTime(event)}<br>
        Energy Level: ${Math.round(event.extendedProps.energyLevel * 100)}%<br>
        Difficulty: ${event.extendedProps.difficulty}<br>
        <br>
        <small>This is an auto-scheduled study block</small>
    `;
    
    showModal('Study Block Details', info);
}

// Show event details
function showEventDetails(event) {
    const info = `
        <strong>${event.title}</strong><br>
        Time: ${formatEventTime(event)}<br>
        Type: ${event.extendedProps.type || 'Unknown'}<br>
        ${event.extendedProps.course ? `Course: ${event.extendedProps.course.toUpperCase()}<br>` : ''}
        ${event.extendedProps.notes ? `<br>Notes: ${event.extendedProps.notes}` : ''}
    `;
    
    showModal('Event Details', info);
}

// Format event time
function formatEventTime(event) {
    const start = new Date(event.start);
    const end = event.end ? new Date(event.end) : null;
    
    const dateStr = start.toLocaleDateString();
    const startTime = start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const endTime = end ? end.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '';
    
    return `${dateStr} ${startTime}${endTime ? ' - ' + endTime : ''}`;
}

// Get event tooltip
function getEventTooltip(event) {
    return `${event.title}\n${formatEventTime(event)}\nClick to ${event.id.startsWith('custom_') ? 'edit' : 'view details'}`;
}

// Show notification
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 24px;
        background: ${type === 'success' ? '#4CAF50' : '#2196F3'};
        color: white;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        z-index: 10000;
        animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Show modal dialog
function showModal(title, content) {
    const modal = document.createElement('div');
    modal.className = 'quick-modal';
    modal.innerHTML = `
        <div class="quick-modal-content">
            <h3>${title}</h3>
            <div>${content}</div>
            <button onclick="this.closest('.quick-modal').remove()">Close</button>
        </div>
    `;
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    `;
    
    modal.querySelector('.quick-modal-content').style.cssText = `
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 400px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    `;
    
    document.body.appendChild(modal);
    
    // Close on background click
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.remove();
        }
    });
}

// Add calendar manager button
function addCalendarManagerButton() {
    const header = document.querySelector('.header');
    if (header && !document.getElementById('calendar-manager-btn')) {
        const button = document.createElement('button');
        button.id = 'calendar-manager-btn';
        button.className = 'calendar-manager-btn';
        button.innerHTML = 'ðŸ“… Calendar Manager';
        button.onclick = openCalendarManager;
        button.style.cssText = `
            margin-left: auto;
            padding: 8px 16px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        `;
        
        button.addEventListener('mouseenter', function() {
            this.style.background = '#1976D2';
            this.style.transform = 'translateY(-1px)';
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.background = '#2196F3';
            this.style.transform = 'translateY(0)';
        });
        
        header.appendChild(button);
    }
}

// Initialize event listeners
function initializeEventListeners() {
    // Update stats when assignments change
    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('assignment-checkbox')) {
            setTimeout(updateSchedulerStats, 100);
        }
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + M: Open calendar manager
        if ((e.ctrlKey || e.metaKey) && e.key === 'm') {
            e.preventDefault();
            openCalendarManager();
        }
        
        // Ctrl/Cmd + S: Run scheduler
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            runAdaptiveScheduler();
        }
    });
    
    // Auto-save periodically
    setInterval(function() {
        if (window.adaptiveScheduler) {
            adaptiveScheduler.saveToStorage();
        }
    }, 60000); // Every minute
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .fc-event {
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .fc-event:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .fc-daygrid-event {
        white-space: normal;
    }
`;
document.head.appendChild(style);

console.log('Enhanced dashboard initialized successfully!');
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>